//==========================================================================
//                standard main program for bignum
//==========================================================================
//  functions for big integer processing based on strings
//==========================================================================
// Date : 19-Oct-04
//        26-Oct-04  define added
//        31-Oct-04  more checks added
//         5-Nov-04  crate random primes with 250 digits, 300 digits
//==========================================================================
// available functions : 
//
// format of input data:
//    strcpy(z2, "894770000077777777777777777774440");
//    strcpy(z1, "-54894");
//
//    char *addsub( in1, in2, result,'+')
//    char *addsub( in1, in2, result,'-')
//    char *mult( z1, z2, result)
//    char *div( dividend, divisor, quotient, rest) .. dividend and divisor destroyed
//    char *divf( dividend, divisor, quotient, rest) .. fast version, dividend
//                                                  and divisor destroyed
//    char *modexp(a, b, n, res) ..... a destroyed
//    char *modexpf(a, b, n, res) .... faster version , a destroyed
//    char *euclidext(e, p, q, d) ... destroys ????;
//    char *bcd_binhex(in, outbin, outhex);
//    char *hex_bcd(inhex, outbcd) ... 
//
//==========================================================================
#include <sys/types.h>
#include <sys/timeb.h>
#include <math.h>
#include <string.h>
#include <assert.h>
#include "../lib/bignum.h"
#include "../lib/prime_100000.c"
//
// functions
//
//  char *addsub1();
//  char *addsub();
//  char *mult();
//  char *div();
//  char *divf();
//  char *divff();
//  char *euclidext();
//  char *modexp();
//  char *modexpf();
//  char *bcd_binhex();
//  char *hex_bcd();
//  int substr();
//  char strchar();
//
// test functions
//---------------------------------------------
//

  char *bin_hex();

//==========================================================================
main(argc,argv)
 int argc;
 char *argv[];
 {
  //char name[100];
  //int j;
  // typedef char verylong[arrayl]; 

  int arrlen = ARRAYLENGTH;

  char zwei[ARRAYLENGTH] = "2";

  char a[ARRAYLENGTH] ;
  char n[ARRAYLENGTH] ;
  char r[ARRAYLENGTH] ;
  char p[ARRAYLENGTH] ;
  char q[ARRAYLENGTH] ;
  char e[ARRAYLENGTH] ;
  char divisor[ARRAYLENGTH] ;
  char dividend[ARRAYLENGTH] ;
  char quotient[ARRAYLENGTH] ;
  char rest[ARRAYLENGTH] ;
  char prime_for_test[ARRAYLENGTH] ;

  char quotient1[ARRAYLENGTH] ;
  char rest1[ARRAYLENGTH] ;
  char quotient2[ARRAYLENGTH] ;
  char rest2[ARRAYLENGTH] ;
  char testzahl[ARRAYLENGTH] ;

  char bin_in_test[ARRAYLENGTH] ;
  char outbcd[ARRAYLENGTH] ;
  int breakflag; 
  char pstr[40] ;


   printf("===================================================\n");
   printf("  Large Integer numbers :\n");
   printf("  Miller Rabin test 26-Oct-04 :\n");
   printf("===================================================\n");
   printf("Compiled with buffer length : %d\n", arrlen);

//-----------------------------------------------------
//
//=======================================================================
//=======================================================================
// serious cryptological uses which rely on the secrecy of the
//  prime factors of a modulus (as they have been published here) but they
// will suffice for testing such algorithms... I started with a string of
// "random" digits (created using <A HREF="http://primes.utm.edu/links/
// programs/large_arithmetic/#UBASIC">UBASIC</A>'s
// irnd() function), checked for small prime divisors, and if there were none,
// I used <A HREF="/research/primes/prove/prove4_1.html">APRT-CL</A> for the primality
// proof (so these are all proven to be primes).
//
// test existing prime numbers next tests all primes
//
//#define TESTA
#ifdef TESTA
// all numbers prime ( from internet page)
// 23 Minuten
//
// test prime numbers from, internet

//Ten random 10 digit primes</h2></a>

strcpy( prime_for_test,    "5915587277"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "1500450271"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "3267000013"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "5754853343"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "4093082899"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "9576890767"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "3628273133"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "2860486313"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "5463458053"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "3367900313"); 
   millerrabintest( prime_for_test, 10); 
//
//Ten random 20 digit primes</h2></a>
//
strcpy( prime_for_test,    "48112959837082048697"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "54673257461630679457"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "29497513910652490397"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "40206835204840513073"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "12764787846358441471"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "71755440315342536873"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "45095080578985454453"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "27542476619900900873"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "66405897020462343733"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "36413321723440003717"); 
   millerrabintest( prime_for_test, 10); 
//
//Ten random 30 digit primes</h2></a>
//
strcpy( prime_for_test,    "671998030559713968361666935769"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "282174488599599500573849980909"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "521419622856657689423872613771"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "362736035870515331128527330659"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "115756986668303657898962467957"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "590872612825179551336102196593"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "564819669946735512444543556507"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "513821217024129243948411056803"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "416064700201658306196320137931"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "280829369862134719390036617067"); 
   millerrabintest( prime_for_test, 10); 
//
//Ten random 40 digit primes</h2></a>
//
strcpy( prime_for_test,    "2425967623052370772757633156976982469681"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "1451730470513778492236629598992166035067"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "6075380529345458860144577398704761614649"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "3615415881585117908550243505309785526231"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "5992830235524142758386850633773258681119"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "4384165182867240584805930970951575013697"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "5991810554633396517767024967580894321153"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "6847944682037444681162770672798288913849"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "4146162919458530168953357282201621124057"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "5570373270183181665098052481109678989411"); 
   millerrabintest( prime_for_test, 10); 
//
//Ten random 50 digit primes    "    "
//
strcpy( prime_for_test,    "22953686867719691230002707821868552601124472329079"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "30762542250301270692051460539586166927291732754961"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "29927402397991286489627837734179186385188296382227"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "46484729803540183101830167875623788794533441216779"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "95647806479275528135733781266203904794419563064407"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "64495327731887693539738558691066839103388567300449"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "58645563317564309847334478714939069495243200674793"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "48705091355238882778842909230056712140813460157899"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "15452417011775787851951047309563159388840946309807"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "53542885039615245271174355315623704334284773568199"); 
   millerrabintest( prime_for_test, 10); 
//
//Ten random 60 digit primes    "    ");"
//
strcpy( prime_for_test,    "622288097498926496141095869268883999563096063592498055290461"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "610692533270508750441931226384209856405876657993997547171387"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "668486051696691190102895306426999370394054817506916629001851"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "313539589974026666385010319707341761012894704055733952484113"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "470287785858076441566723507866751092927015824834881906763507"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "361720912810755408215708460645842859722715865206816237944587"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "378348910233465647859184421334615532543749747185321634086219"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "669483106578092405936560831017556154622901950048903016651289"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "351300033958683656629281197430236951045077917074227778834807"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "511704374946917490638851104912462284144240813125071454126151"); 
   millerrabintest( prime_for_test, 10); 
//
//Ten random 70 digit primes    "    "
//
strcpy( prime_for_test,    "4669523849932130508876392554713407521319117239637943224980015676156491"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "4906275427767802358357703730938087362176142642699093827933107888253709"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "2409130781894986571956777721649968801511465915451196376269177305066867"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "7595009151080016652449223792726748985452052945413160073645842090827711"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "3822535632033509464266159811805197854872067042990716005808372194664933"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "5885903965180586669073549360644800583458138238012033647539649735017287"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "5850725702766829291491370712136286009948642125131436113342815786444567"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "4237080979868607742750808600846638318022863593147774739556427943294937"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "3773180816219384606784189538899553110499442295782576702222280384917551"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "9547848065153773335707495885453566120069130270246768806790708393909999"); 
   millerrabintest( prime_for_test, 10); 
//
//Ten random 80 digit primes    "    ");"
//
strcpy( prime_for_test,    "18532395500947174450709383384936679868383424444311405679463280782405796233163977"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "39688644836832882526173831577536117815818454437810437210221644553381995813014959"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "44822481511601066098713481453161748979849764719554039096395688045048053310178487"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "54875133386847519273109693154204970395475080920935355580245252923343305939004903"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "40979218404449071854385509743772465043384063785613460568705289173181846900181503"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "56181069873486948735852120493417527485226565150317825065106074926567306630125961"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "19469495355310348270990592580191998639221450743640952620236903851789700309402857"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "34263233064835421125264776608163440537925705997962346596977803462033841059628723"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "14759984361802021245410475928101669395348791811705709117374129427051861355011151"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "67120333368520272532940669112228025474970578938046280618394371551488988323794243"); 
   millerrabintest( prime_for_test, 10); 
//
//Ten random 90 digit primes    "    ");"
//
strcpy( prime_for_test,    "282755483533707287054752184321121345766861480697448703443857012153264407439766013042402571"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "370332600450952648802345609908335058273399487356359263038584017827194636172568988257769601"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "463199005416013829210323411514132845972525641604435693287586851332821637442813833942427923"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "374413471625854958269706803072259202131399386829497836277471117216044734280924224462969371"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "664869143773196608462001772779382650311673568542237852546715913135688434614731717844868261"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "309133826845331278722882330592890120369379620942948199356542318795450228858357445635314757"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "976522637021306403150551933319006137720124048624544172072735055780411834104862667155922841"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "635752334942676003169313626814655695963315290125751655287486460091602385142405742365191277"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "625161793954624746211679299331621567931369768944205635791355694727774487677706013842058779"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "204005728266090048777253207241416669051476369216501266754813821619984472224780876488344279"); 
   millerrabintest( prime_for_test, 10); 
//
//Ten random 100 digit primes    "    ");"
//
strcpy( prime_for_test,    "2074722246773485207821695222107608587480996474721117292752992589912196684750549658310084416732550077"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "2367495770217142995264827948666809233066409497699870112003149352380375124855230068487109373226251983"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "1814159566819970307982681716822107016038920170504391457462563485198126916735167260215619523429714031"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "5371393606024775251256550436773565977406724269152942136415762782810562554131599074907426010737503501"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "6513516734600035718300327211250928237178281758494417357560086828416863929270451437126021949850746381"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "5628290459057877291809182450381238927697314822133923421169378062922140081498734424133112032854812293"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "2908511952812557872434704820397229928450530253990158990550731991011846571635621025786879881561814989"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "2193992993218604310884461864618001945131790925282531768679169054389241527895222169476723691605898517"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "5202642720986189087034837832337828472969800910926501361967872059486045713145450116712488685004691423"); 
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,    "7212610147295474909544523785043492409969382148186765460082500085393519556525921455588705423020751421"); 
   millerrabintest( prime_for_test, 10); 
#endif
//#define TESTB
#ifdef TESTB

strcpy( prime_for_test, "499490918065850301921197603564081112780623690273420984342968690594064612108591217229304461006005170865294466527166368851");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "527654088646108540362982390044019863852553381756839064739589507767331089783254199732302674718497125124586822562788766953");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "171989218832470870857923701742780850419373475175043795375607676047792517311566339217543754147263751973899368604441353849");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "566039327581077714561506815784669881914684785030580378761402844355426865405282719619236551816895924694614829004713040283");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "897503957504227472139484199430066010338139343163145419280183314291067450988520718807102741476596034735471026312154231263");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "745213698191737003631319694753125429293968166002970537936165661845575001172678049743806549549977234670072449443569701103");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "420145406901811857791227072284165226561693483222287527567496017033892563342686752247587935117119306171161848593337649107");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "371132472088173209741153184981742771278849120163424101995797949338636074962048027958518451774716413729510755717494155299");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "284563744015440547449076942566482643882733461003510727231069524112903402006758875891142531990667183056335233985448160393");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "506283312611011343355256478253272463245968105632679003983305635125224133331073348553775052064302641255435067238306718511");   
   millerrabintest( prime_for_test, 10); 
#endif
//#define TESTC
#ifdef TESTC
// pentiom 650 18 min
//Ten random 130 digit
//primes</H2>
strcpy( prime_for_test, "5452212151844264453115521770362712815300456788073870260637172006414987479914150831821202259862091373741738511579629040732909194883");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "6539010935836249262943170849578201335017375258186767902505297465587122376751466876714291620849745334794779375900778144335240097113");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "3983839527542885537740733863182378190963726188502990729675389352191015499474350038278492444248168771788283801258341599238380122941");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "1966605170351883122720890324745439659237468374231783680395362721624862483865065649496199746596592488851227128040234894355126333577");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "8396165654625010853235718432422971894820959019173552531407618141479187464219101476472619790871280738143334218241399043466521187861");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "8714772976381697859557965355791745997987728300226812732519702250463329265826033268926171610392211750044957719896320776794555146581");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "4578487274208482739785211870551459143579948064875277467213620367693698827278583879146069992097475604136147868628836746016239588907");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "4486847188052919998840445633197185837412694555920470505272960880292118699574860419602025075639197639973623241174554640239940468491");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "3007481519774841700447169103699480479257075158004429172505493169624211738165626204221653115518171895124254955050192476647393240549");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "1182911141497541140586615359230243592834259935951457923890100901143724702295750543180757886003762250822014770432406785975220712551");   
   millerrabintest( prime_for_test, 10); 
#endif
//#define TESTD
#ifdef TESTD
// pentium 650 23 min
// Ten random 140 digit
strcpy( prime_for_test, "49105133753678962419391374496727457097027115514864975959094375339860082156189031654878635228598019107441653554142227931036658923353143622433");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "11116154175595527770308362725647119128773382144932530406518516557686437868255855652082462548879461003460118188231013636706338524913578946637");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "64245974067698974727308576291067189905635129662015537917175582385219809100094736540969262037560193877488366836626125921856719528308413429711");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "34485079630805051859266175091271301167552335355835904557317673250957626391924088349446387354547510877224494992751398370525640861207657983831");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "66731226481164861907172210444443387725765534787685596039704030813005211489254073056730659671250155829101672315910005890867685131395246929621");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "40715419051417482519286539367794251058952189812236314107150220232148457082328798652774511688107134820082466929596616575469866935012183992821");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "66584720460899785255133191060974440278633915171229599356820775802394462756364476093414927157574862478083047015999630105316838183873438847653");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "21384673207444598953944295269132432413002706756010583952155931098725644623031415143234836631619334100621702323118864487149301235435577193841");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "11972074619991162245806805523618114505186632677199227008626207635331666111231564033315528198753090956109606784942142173066807025406537144269");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "47691027682862136953792492644313896868091731521408932524622766147428587604078803781777571528885751867730427043206604868334701714257315063321");   
   millerrabintest( prime_for_test, 10); 
#endif
//#define TESTE
#ifdef TESTE
// 30 min pentium 650
// Ten random 150 digit
strcpy( prime_for_test, "656692050181897513638241554199181923922955921760928836766304161790553989228223793461834703506872747071705167995972707253940099469869516422893633357693");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "204616454475328391399619135615615385636808455963116802820729927402260635621645177248364272093977747839601125961863785073671961509749189348777945177811");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "641452276181854641108656711212426007392032535624286593352297230739655033308758795291525780661276052003446415402951276859305010843331485955731317776341");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "550260068503913816794775756748734957217525557101277352617939473192429642846467658900405045171852174534967724674742228789190327015236678532191013890529");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "583131835487211382864869404486578252043523081801125909471858006868782832566750509413463775974331289075956651335069566640737433078846977125660198697601");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "481771005726160896474733768194850858215460011981072890995785634836450544884821582740744524775771150682846683947122626400704738713943115881075765362233");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "291550339212810520584591717024643003222896524222464547399033563270236499245759688372706177143834849792024373534800701771810502419549113758796692666163");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "375558729886621567205449255384643401545510736101936314566046534513364279097663141755273454199533071264570131949667792104742749053406471675458926748329");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "422462939821987611668765003928357286531370604744014357581168779580028475979643188965993226794774506766569981531095464740448051585829856696356931372077");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "533791764536500962982816454877600313815808544134584704665367971790938714376754987723404131641943766815146845004667377003395107827504566198008424339207");   
   millerrabintest( prime_for_test, 10); 
#endif
//#define TESTF
#ifdef TESTF
// 36 min
//Ten random 160 digit
strcpy( prime_for_test, "5166566839092074458466334866571597694114460570387986357538048450432901440804868689337999823161841839689242893622491638917313351308387294478994745350551549126803");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "1081298104698286063813737967304568031406522676857739555339880517562925221530558524296599584286163751908713364829390795648074146197550782524900963175263757603219");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "3453221202185876906638629632175359499099670410652382616441386629981117932849225524689308950511055601388422752776562037360817653410867799137900072936906881621341");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "9379635662817322614032764342613018955177071738482024436203544111095204370743225356112956525567890031429756904091450073222354327129541982170431394374683183905361");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "5051274906171681915609732690658365816679515685799846683178436173836692151960702168161668828019540237543601958873479825452017776485422833955447384989249284184721");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "5322540848240629191790738444031509035347191367506640093778351221586257526250970342938004178185797187285021641998886132756315601193005759267241157022234467562219");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "1455092030073910097728935799403514951916017440761637615082797822300258672552113841248699383510679651371967303150469080892197381266011701672658746284897197497381");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "5606221897419357203717805716775608610818309221516900659695848705842741725747203626727997867908348514759500625526025583533605817877234533489367251260903607478353");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "5527520013513581326121882167187180752073463254277609911934750350965822023838543172229709244319844670433804038920304644097364765738975596420673642099039975011363");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "8726641590503419650325196619937603416439489172580927797921688450581350540574217626151578525827423033276197489219680752921410238881917731681447358498204217268973");   
   millerrabintest( prime_for_test, 10); 
#endif
//#define TESTG
#ifdef TESTG
// 47 min
//
// Ten random 170 digit
//
strcpy( prime_for_test,"27218343798190233889779431662111815254174074647423987223301820996324728298888643331463792254937414353096518304763345896749125106775048493507719412795029690510090142402163");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"23479698886588057849314652964503798247894914124551260174218648067666102051616418999379517315316310948034679067621031740436103067802280750009256267288057226668309143457227");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"37745683039627526420239498495450014901855006768892775749597403587571970429951577000073551065765218057239528311184736067680411048526187122288661901211789066482483802580969");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "25289360766441467649688504294463889446448599958369578031987146079083964767320568714708933904456399649486377191080905641924169884768743883883122555185485514190467624449551");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"24707159238131828525246120097499842650897794755532338306235565601244424543951799559126922000454067400268976841496109148609082939948473601049154232553757862489698258605853");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"11067896864151107888327210475457768522190748228130894643297732650458556828346322177345544084702872726772673298479414374934206448595620856513559764913452487779500078246341");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"32559552391090806972524986110685454429554861128146958282307580573550839559287659656080789996587490910999032609385668148399053113719642305511467653200258413635664259044077");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"21160656367574879904377656869692416560544398642776271862237616754494681129688319299114321001429667792412314306472092655735101612562676478693400212218038544113953364215017");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"61666372912245863887684510042656975220774126438327774649153997946400603024380560713336470674573893680427095868805106128483007129797880040347838399734458883689665738771401");  
   millerrabintest( prime_for_test, 10); 
#endif
//#define TESTH
#ifdef TESTH
// Ten random 180 digit
//primes>
strcpy( prime_for_test,"278344420100310216738042441752470108332323908618219525487053710207384771998286597135290418719526702385178365896340210957041552257518693488098683242070746473230980005141419410511409");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"320736475415476717732845847804491817446796189216456349827613663809340822922694550151574791812248563125599721479222153825117457246563639563061051392846797489177980112851325768344559");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"142421590971309087406926930527203509136940618029846108794169863876683171607366571570400885831140555590135576733907110189937788062898855050894112651266072474307203583352058594056699");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test, "593386707196164010234957027152328419042268655361978864426901926544572190528234802779306531224367755063388901572628462922632051330287480604978716718812759319920068478420695386733977");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"539813721464880304831529082014022773775683060863538731923720954030918288330963319766918459920070168122735288577580167859459419843291482297756648680136952821437700382745720613744889");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"702859775508284030177919822558533006622440218103436237875100165464040768114702545328008730929739757973342358123790248243520711425000515624162703794316531258568583660237867578953203");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"589923621255019726527156285165428517384575357899722584047925764507589046990787480142415727801592836084346585615425741080198942707921115063808994265792045768353585364564118062957787");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"988024003287850859144419046035039824149244726706784277084869779315425892879684597047236357710409517227957670271186515606462572615012822834344038901575679797975183588867579172966813");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"138213346659325495152622898059934026500376715277553735568741631802223631560816340153124059134633703518065997351958412091563280756663245714418839097788427301498366707042110549313861");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"471205606356071374530123676066132028268795965340695231968997455114791533754710267882707803660862532294335641905789356930854538689737478965628971918765260914629519973512861866553639");  
   millerrabintest( prime_for_test, 10); 
#endif
//#define TESTI
#ifdef TESTI
// 150 min for 190 and 200
// Ten random 190 digit
// primes>
strcpy( prime_for_test,"5077461915617371651811593607389848534613910665160223569902404065418076795944656510340577164207672426574638345121648036693344561339868694500127046808526397857391514634557427341972391976756821");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"3643214290461749241398376492190485585384494258388704356737409156502890948489887688353135368121060124798243703432841307147301729071453564875847359568200406818058535340069409695144897237869317");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"4837500633209442055641398894165176677263201858612849667774338162796452956137875114054119135158253792745804801331435807680095292929070880966039245167637417105254552418199073193006899620258743");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"5064136420884335501689838367952088390096266110228352307574884705496445677489534139564287934932824628345958454364410762801533170309041049312348967102909660236959079889483131581136712490172401");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"4947086496071166703965587250769146731394104165275866303181215156028400564026120863996103770059401062730476737276710433726862730040272631518430581458702841125762611304768397806110371404797599");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"2555480246614015637242066218495468367958491958791520916609927980929585688386540022963356429758954681777165591120866518535295021508514987925230304828573354059077193219265153006831360318167711");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"6147641397250417452064510622317426991922141655515696005876029122575608297348771297503208386454555057912601512502968808491467996190208261151248935017610034239813017874230478567438939516320017");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"3729231811884409820753681077055613011460474576134694905553319621800309295745959102074992512763282727699369957535526308579436199715035503019092827130578496450550629794274344813564303318059743");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"6455677032078134615122923256047783642469165615329330252550539894033032422509072781300599341862693333305369588191523252516876513543095490001221889525858323800754356138220797092839047522855519");  
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"5026229637416821096651957347055990616313190018857502650953480553921800879342828248572616370546407789646201959941290047780315122634922833439742729257401674232444211439320664156608343988857391");  
   millerrabintest( prime_for_test, 10); 
#endif
//#define TESTJ
#ifdef TESTJ
// Ten random 200 digit
// primes
strcpy( prime_for_test,"58021664585639791181184025950440248398226136069516938232493687505822471836536824298822733710342250697739996825938232641940670857624514103125986134050997697160127301547995788468137887651823707102007839");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"29072553456409183479268752003825253455672839222789445223234915115682921921621182714164684048719891059149763352939888629001652768286998932224000980861127751097886364432307005283784155195197202827350411");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"41184172451867371867686906412307989908388177848827102865167949679167771021417488428983978626721272105583120243720400358313998904049755363682307706550788498535402989510396285940007396534556364659633739");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"54661163828798316406139641599131347203445399912295442826728168170210404446004717881354193865401223990331513412680314853190460368937597393179445867548835085746203514200061810259071519181681661892618329");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"71611195866368241734230315014260885890178941731009368469658803702463720956633120935294831101757574996161931982864195542669330457046568876289241536680683601749507786059442920003278263334056542642264651");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"28591045597720075832628274729885724490653298360003309382769144463123258670807750560985604954275365591715208615509779345682419533206637382048824349415329839450792353652240682445321955199147316594996133");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"49790921912819110019003521637763748399072771256062128988437189616228355821145834783451215869998723492323628198577054239101181556609916127864608488018093426129641387774385490891035446702272744866010729");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"15474811206486587193258690501682404626361341756658894201908294153626080782693777003022566996735796983239343580281979005677758015801189957392350213806122307985157041153484138150252828152419133170303749");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"12654646219963267405298825104551142450213038420566798208417393291567314379831789259173233506811083774527183953999862675239292185131178671317061020444490733287588383918793095608410078925861028249824377");   
   millerrabintest( prime_for_test, 10); 
strcpy( prime_for_test,"40992408416096028179761232532587525402909285099086220133403920525409552083528606215439915948260875718893797824735118621138192569490840098061133066650255608065609253901288801302035441884878187944219033");   
   millerrabintest( prime_for_test, 10); 
// by Chris Caldwell>
//=======================================================================
//=======================================================================
// xxxx
#endif
//#define RSA155
#ifdef RSA155
//
// rsa155
//----------
//
// prime
  strcpy(q, "12844205165381031491662259028977553198964984323915864368216177647043137765477");
   strcpy( prime_for_test, q);
   millerrabintest( prime_for_test, 10); 
// n is composit
  strcpy(n, "10742788291266565907178411279942116612663921794753294588877817210355464150980121879033832926235281090750672083504941996433143425558334401855808989426892463");
   strcpy( prime_for_test, n);
   millerrabintest( prime_for_test, 10); 
#endif
//
//
//=======================================================================
//#define TEST6
#ifdef TEST6
//
// rsa243
//---------
//
   strcpy(e,"508075310835159009812633969174411123496728859672737076695139826186257647581337481521676692825102982808222076238747753504407");
   strcpy( prime_for_test, e);
   millerrabintest( prime_for_test, 10); 
   strcpy(p,"25110719126901354976190933395867124680240805711276844886250959824156205188949406184735295788387561135167529430243075948799");
   strcpy( prime_for_test, p);
   millerrabintest( prime_for_test, 10); 
   strcpy(q,"25110719126901354976190933395867124680240805711276844886250959824156205188949406184735295788387561135167529435118429780319");
   strcpy( prime_for_test, q);
   millerrabintest( prime_for_test, 10); 
// n243  .... composite
   strcpy(n,"6305482150701295471567183324958896322344341454119712758883769876032602");
   strcat(n,"2525278792613527673894410568910003629553586814142438653640364957870769");
   strcat(n,"9128189491432138631900590774729214990015369102760964884776344849717811");
   strcat(n,"484309528915040117952098061886881");
   strcpy( prime_for_test, n);
   millerrabintest( prime_for_test, 10); 
#endif
//
//=======================================================================
//#define TEST5
#ifdef TEST5
//
// oss129
//--------
//
// public modulus
// oss129
   strcpy( testzahl,"114381625757888867669235779976146612010218296721242362562561842935706935245733897830597123563958705058989075147599290026879543541");
   millerrabintest( testzahl, 10); 
//# public exponent
// oss_e = "9007"
// factoring done 1994 17 years later
// oss_p64 = "3490529510847650949147849619903898133417764638493387843990820577"
 strcpy( testzahl,"3490529510847650949147849619903898133417764638493387843990820577");
   millerrabintest( testzahl, 10); 
// oss_p65
// strcpy( testzahl,"32769132993266709549961988190834461413177642967992942539798288533");
   millerrabintest( testzahl, 10); 
#endif
//
//=======================================================================
//#define TEST4
#ifdef TEST4
//-------------------------------
//this number is prime !!!
//the following composite number is failing every primality test I ran it
//across.
//Any ideas?
//Thanks, Flip
   strcpy( prime_for_test, "4934673806156388163176845045527104259242504392822688623822144");
   strcat( prime_for_test, "81069979759413742943343660994174309730576376709981153337038337");
   strcat( prime_for_test, "833607099357863733152761402652533");
   millerrabintest( prime_for_test, 10); 
//-------------------------------
#endif
//
//
//=======================================================================
//#define TEST3
#ifdef TEST3
// 
// Fehler in maple
// composite = 106219 * 212437
   strcpy( prime_for_test,"2264845703");
   millerrabintest( prime_for_test, 10); 
// composite
   // pseudoprim 11*31
   strcpy( prime_for_test,"341");
   millerrabintest( prime_for_test, 10); 
   // Carmichael 3 * 11 * 17
   strcpy( prime_for_test,"561");
   millerrabintest( prime_for_test, 10); 
   // Carmichael 7 * 13 * 19
   strcpy( prime_for_test,"1729");
   millerrabintest( prime_for_test, 10); 
#endif
//
//=======================================================================
// check any numbers 
// create a list of prime numbers
//#define TEST2 
#ifdef TEST2
   int xx;
   for( xx = 100001; xx <= 105000 ; xx = xx+1) { 
   sprintf(prime_for_test, "%d",xx);
   millerrabintest( prime_for_test, 10); 
   }
#endif
//
//=======================================================================
// test of prime numbers from prime table
// all numbers prime
//
//#define TEST1
#ifdef TEST1
   int ii;
   for( ii=80000 ; ii <=81000 ; ii++) {
   // printf( "> %d  %d \n", ii, primetable[ii]); 
   sprintf( prime_for_test ,"%d", primetable[ii]); 
   millerrabintest( prime_for_test, 10); 
   }
#endif
//=======================================================================
// test
// any large number, count up
//-----------------------------
//#define TEST0
#ifdef TEST0
   int ii;
   strcpy( testzahl, "123456789012345678901234567890123456789012345678901234567890123456789");
   for( ii=1 ; ii<=50000 ; ii++) {
   addsub( testzahl, zwei, prime_for_test,'+'); 
   millerrabintest( prime_for_test, 10); 
   strcpy( testzahl, prime_for_test);
   }
#endif
//=======================================================================
// test
// any large number, count up
//-----------------------------
//#define TEST00
#ifdef TEST00
   int ii;
   strcpy( testzahl, "1234567890123456789012345678901234567890123456789012345678901234567890");
   strcat( testzahl, "1234567890123456789012345678901234567890123456789012345678901234567890");
   strcat( testzahl, "1234567890123456789012345678901234567890123456789012345678901234567890");
   strcat( testzahl, "123456789012345678901234567890123456789012345678901234567890123456789");
   for( ii=1 ; ii<=200 ; ii++) {
   addsub( testzahl, zwei, prime_for_test,'+'); 
   millerrabintest( prime_for_test, 10); 
   strcpy( testzahl, prime_for_test);
   }
#endif
//===========================================================
#define TESTU
#ifdef TESTU
//
// create random prime
//---------------------
   srand(( unsigned) time (NULL));
//
   int ii,randlength;
   long kk;
   randlength = 500 ;
//
   for(ii=1; ii<= 30000; ii++) {
     randbigint( prime_for_test, randlength);
     breakflag = 0;
     // printf( "prime for test : %s  length : %d\n", prime_for_test, strlen(prime_for_test));
     //
     // divide by small prime numbers
     //
     for( kk=0 ; kk <= 30000 ; kk++) {
        sprintf( pstr ,"%d", primetable[kk]); 
        strcpy( dividend, prime_for_test) ;
        strcpy( divisor, pstr);
        //
        //printf( "dividend : %s\n",  dividend); 
        //printf( "divisor  : %s\n",  divisor); 
        //
        divf( dividend, divisor, quotient, rest); 
        //
        if(strcmp( rest, "0") == 0) {
           printf( "number is composit : divided by prime : %s    prime pos : %d\n", pstr, kk) ;
           breakflag = 1;
           break;
        }
     }
     if(! breakflag) {
       millerrabintest( prime_for_test, 10); 
     } 
   }
#endif
//==========================================================================
}   
//=======================================================================
//
//
//===================================================================
//                  m i l l e r _ r a b i n 
//===================================================================
// written by aob : 19.10.04
//===================================================================
// miller rabin probabilistic primality test
// see Handbook of applied cryptography  4.24 page 139
// and sci.crypt 1997/06/27  freelip Miller Rabin probabilistic Primality test
// implementation (James Pate Williams)
//===================================================================
// -------------- start miller rabin --------------------
//
   int millerrabintest( prime_for_test, iterations) 
     char *prime_for_test;
     int iterations;
   {
   verylong za, zb, zn, zn1,zr,zy;
   verylong inbcd, outbin, outbcd, outhex;

   char eins[ARRAYLENGTH] = "1";
   char zwei[ARRAYLENGTH] = "2";
   // char drei[ARRAYLENGTH] = "3";
   char strdummy[ARRAYLENGTH] ;
   char quotient[ARRAYLENGTH] ;
   char rest[ARRAYLENGTH] ;
   char hex_out_test[ARRAYLENGTH] ;

   int lll, le, iter, length_zn1, comp1, comp2, j_mr, s_mr;
   int composflag, subloopflag, subloopflag_intern, value;
   char last_bit;

   printf( "\n");
   printf( "<<<<<<<<< miller rabin primality test <<<<<<<<<\n");
   printf( "\n");

   lll = strlen( prime_for_test);
   printf("number for test : %s length : %d\n", prime_for_test, lll);
   strcpy( zn , prime_for_test);
// odd ?
   strcpy( strdummy, zwei);
   divf( zn, strdummy, quotient, rest); 
//
   if(strcmp( rest, "0") == 0) {
     printf( "Miller Rabin test : number for check is even number\n");
     printf( "<<<<<<<<< end of miller rabin test <<<<<<<<<\n");
     return(0);
   }
// > 3,  but we check for 3 digits to get random number 
   strcpy( zn , prime_for_test);
   if( lll <= 2) {
     printf( "Miller Rabin test : number for check should be > 100\n");
     printf( "<<<<<<<<< end of miller rabin test <<<<<<<<<\n");
     return(0);
   }
//
// subtract 1
//
   addsub( zn, eins, zn1, '-');
   strcpy( zr, zn1 );
   strcpy( inbcd, zr );
   //printf("inbcd : %s\n", inbcd);
   bcd_binhex(inbcd, outbin, outhex);
   //printf( "   outbin :%s\n", outbin);
//
// get last bit
//
   le = strlen( outbin);
   last_bit = strchar( outbin, le); 
   //printf( "lastbit: %c\n", last_bit) ;
//
// convert zn1 : 2^s*r  ... r odd
//---------------------------------
//
   s_mr = 0;
   //printf("----------------------\n");
   for(;;) {
     if( last_bit == '1') break;
     s_mr++;
     le = strlen( outbin);
     last_bit = strchar( outbin, le - 1); 
     outbin[le - 1] = '\0';
     // printf( " x outbin :%s\n", outbin);
   }
   //printf("----------------------\n");
   // printf( " y outbin :%s s: %d\n", outbin, s_mr);
//
   bin_hex( outbin, hex_out_test);
   // printf("hexout : %s \n", hex_out_test);
   hex_bcd(hex_out_test, outbcd); 
   printf("=============== convert n-1 : (2^s)*r  ... r odd ===============\n");
   strcpy( zr, outbcd);
   printf("   n-1 : %s\n", zn1);
   printf("   r   : %s\n", zr);
   printf("   s   : %d\n", s_mr);
//
// loop iterations
//-------------------------------------
//
// initialize random generator
//
   srand(( unsigned) time (NULL));
//
// main loop of miller rabin check
//------------------------------------------------------------
   length_zn1 = strlen(zn1);
   composflag = 0;
   subloopflag = 0;
   subloopflag_intern = 0;
   value = 1;
   for( iter = 1 ; value && iter <= iterations ; iter++) {
    printf("=============== begin of miller rabin main loop : %d ===============\n", iter);
     // get random number >=2 and < zn1
     // check for small numbers
     randbigint( za, length_zn1-1); 
     //
     printf("   za : %s\n", za);
     printf("   zr : %s\n", zr);
     printf("   zn : %s\n", zn);
     modexpf(za, zr, zn, zy);      // za destroyed 
     printf(" zy =  (za^zr) mod zn : %s\n", zy);
     comp1 = strcmp( zy, eins);
     comp2 = strcmp( zy, zn1);
     if( comp1 != 0 && comp2 !=0) {
         subloopflag ++;
         j_mr = 1;
         printf("=============== begin sub loop  ===============\n");
         while( value && j_mr <= s_mr - 1 && strcmp( zy, zn1) != 0) {
             subloopflag_intern ++;
             printf("   j    : %d\n", j_mr);
             printf("   zy   : %s\n", zy);
             //printf("   zwei : %s\n", zwei);
             printf("   zn   : %s\n", zn);
             modexpf(zy, zwei, zn, zb);      // zy destroyed 
             printf(" (zy*zy)mod zn  : %s\n", zb);
             //printf("   zwei : %s\n", zwei);
             strcpy( zy, zb) ;
             if( strcmp( zy , eins) == 0) {
                printf("zy = 1 : composite\n");
                composflag = 1;
                value = 0;
             }
             j_mr++;
         } 
         printf("=============== end sub loop  ===============\n");
         if( strcmp( zy , zn1) != 0) {
            printf(" zy != zn : composite\n");
            composflag = 1;
            value = 0;
         }
     }
    printf("=============== end of miller rabin main loop ===============\n");
   }
   //
   // summary of test
   // 
   //
   if(!composflag) {
   printf("number is prime : %s s : %d sl : %d sli : %d\n", zn, s_mr, subloopflag, subloopflag_intern);
   } else {
   printf("number is composite : %s s : %d sl : %d sli : %d\n", zn, s_mr, subloopflag, subloopflag_intern);
   }
   printf( "\n");
   printf( "<<<<<<<<< end of miller rabin test <<<<<<<<<\n");
   printf( "\n");
   return(0);
 }
//===================================================================
//                          b i n h e x 
//===================================================================
//
  char *bin_hex(bin, hex)
   char  *bin, *hex;
   {
   char *bcdd, *bcdb, *bcdh;
   int bcd_ok, i, ii, ki, declen, reglen;
   int k, block, mainl; 
   char group4[10], group4_1[10];
   char bitout; 
   char bitout_arr[5];
   char corrflag[10];
   char bcd_digit, bcd_bad;
   char binreg[ARRAYLENGTH];
   char binres[ARRAYLENGTH];
   char hexreg[ARRAYLENGTH];
   char dummy[ARRAYLENGTH];

   char bin_digit;
   char list1[10] = "0123456789";
   int bcdddebug;
   int binlen, binlen1, binlen4, hex_mod, bin_ok, bin_bad;
   struct bin { 
        char *binval ;
   } bintab[] ={
                 {"0000"}, 
                 {"0001"}, 
                 {"0010"}, 
                 {"0011"}, 
                 {"0100"}, 
                 {"0101"}, 
                 {"0110"}, 
                 {"0111"}, 
                 {"1000"}, 
                 {"1001"}, 
                 {"1010"}, 
                 {"1011"}, 
                 {"1100"}, 
                 {"1101"}, 
                 {"1110"}, 
                 {"1111"} 
   };
   struct hex { 
        char *hexval ;
   } hextab[] ={
                 {"0"}, 
                 {"1"}, 
                 {"2"}, 
                 {"3"}, 
                 {"4"}, 
                 {"5"}, 
                 {"6"}, 
                 {"7"}, 
                 {"8"}, 
                 {"9"}, 
                 {"A"}, 
                 {"B"}, 
                 {"C"}, 
                 {"D"}, 
                 {"E"}, 
                 {"F"} 
   };
//
// 
   int binhexdebug = 0;
   if(binhexdebug) printf("binhex : bin : %s\n", bin);
   if( strlen(bin) < 1){
     printf( "binhex:  Input Error bin \n");
     printf( "binhex:  Zero length string \n");
     printf( "binhex:  === binhex terminated abnormally ===\n");
     strcpy( hex,"bcd conversion error");
     return( hex);
   }
   binlen = strlen(bin);
//
// check valid bin string
//
   if(binhexdebug) printf("binhex : length %d\n", binlen);
   bin_ok = 0;
   for(ii= 1 ; ii <= binlen; ii++) {
     bin_digit = strchar( bin, ii);
         if(bin_digit == '0'){
           bin_ok++;
         }
         if(bin_digit == '1'){
           bin_ok++;
         }
   }
  if( bin_ok != binlen) {
    bin_bad = binlen - bin_ok;
    printf("bin_hex: Illegal bin number : %s\n", bin);
    printf("bin_hex: Number of bad characters: %d\n", bin_bad);
    strcpy(hex,"illegal bin number");
    return(hex);
  }
//
   hex_mod = binlen % 4;
   if( hex_mod != 0 ) {
      if(hex_mod == 1) {
        strcpy( dummy, "000");
        strcat( dummy, bin);
        strcpy( binreg, dummy);
      }
      if(hex_mod == 2) {
        strcpy( dummy, "00");
        strcat( dummy, bin);
        strcpy( binreg, dummy);
      }
      if(hex_mod == 3) {
        strcpy( dummy, "0");
        strcat( dummy, bin);
        strcpy( binreg, dummy);
      }
   } else {
     strcpy( binreg, bin);
   }
//   
   if( binhexdebug) printf("binhex : binreg: %s \n", binreg);
      binlen1 = strlen( binreg);
      binlen4 = binlen1/4;
      strcpy( hexreg, "");
      //loop over all 4 bit groups
      for(i = 1;  i <= binlen4;  i++) {
        k = (i - 1) * 4 + 1 ; 
        substr(binreg, group4, k, 4);
         for(k=1; k <=16; k++) {
           if(strcmp(group4,bintab[k-1].binval) == 0) break;
         }
         if(binhexdebug) printf("binhex : group : %d %d %s \n", i, k, group4);
         strcat( hexreg, hextab[k-1].hexval);
      } 
      if(binhexdebug) printf("binhex : %s\n", hexreg);
      strcpy( hex, hexreg);
      return( hex);
 }
//==========================================================================
